{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Learn More About {{ object.fullname }}{% endblock %}

{% block meta_description %}{% if object.is_running %}{{ object.fullname }} is running for Cambridge City Council.{% endif %}{% endblock %}

{% block head_extra %}
<meta property="og:image" content="{{ object.headshot }}">


<script>
    // data for candidate_map.js
    var initialLocations = {{ candidate_locations|safe }};
</script>
<script async src="{% static "overview/candidate_map.js" %}"></script>
<script async defer src="//maps.googleapis.com/maps/api/js?&callback=initMap&key=AIzaSyAEvfFrHVngbhqmwUbmZIGrxJpTNReCIeY"></script>

<style>
#map {
    height: 400px;
    width: 100%;
}
caption {
    font-size: 2em;
    font-weight: bold;
}
</style>
{% endblock %}


{% block content %}
<div class="row">
    <div class="col-md-4">
        {# too thin to stand on it's own #}
        {% include "overview/candidate_card.html" with candidate=object only %}
    </div>

    <div class="col-md-8">
        {% if object.is_running == False %}
        <div class="alert alert-danger">This candidate is <strong>not running</strong> in 2017</div>
        {% elif object.is_running == None %}
        <div class="alert alert-warning">
            This candidate has not declared yet for 2017, but we think they might be planning to.
            <a class="alert-link" href="mailto:{{ CONTACT_EMAIL }}">Contact us</a> to update their status.
        </div>
        {% endif %}

        <table class="table table-condensed">
            <colgroup>
                <col style="width: 20%"></col>
            </colgroup>
            <tr>
                <th>Incumbent?</th>
                <td>{{ object.is_incumbent|yesno:"Yes,No" }}</td>
            </tr>
            <tr>
                <th>Running?</th>
                <td>{{ object.is_running|yesno:"Yes,No,Maybe" }}</td>
            </tr>

            {% if object.website %}
                <tr>
                    <th>Website</td>
                    <td><a href="{{ object.website }}" target="_blank">{{ object.website }}</a></td>
                </tr>
            </tr>
            {% endif %}

            {% if object.facebook %}
                <tr>
                    <th>Facebook</th>
                    <td><a href="{{ object.facebook }}" target="_blank">{{ object.facebook }}</a></td>
                </tr>
            </tr>
            {% endif %}

            {% if object.address %}
                <tr>
                    <th>Address</th>
                    <td>{{ object.address }}</td>
                </tr>
            </tr>
            {% endif %}

            {% if endorsements %}
                <tr>
                    <th>Endorsements</th>
                    <td>
                        {% for endorsement in endorsements %}
                        <a href="{{ endorsement.link }}" target="_blank" data-toggle="tooltip" title="{{ endorsement.organization.name }} endorsed {{ object.shortname }} on {{ endorsement.date|date }}">
                            {% if endorsement.organization.logo %}
                                <img style="max-height: 30px; max-width: 30px" src="{{ endorsement.organization.logo.url }}" />
                            {% else %}
                                {{ endorsement.organization.name }}
                            {% endif %}
                        </a>
                        {% endfor %}
                    </td>
                </tr>
            {% endif %}

        </table>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div id="map" class="map-container">
            <div class="map-alert">
                <div class="alert alert-warning" data-bind="text:gerror"></div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <h2>Campaign Finance</h2>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="panel panel-money">
            <div class="panel-heading panel-heading-money">
                <h3 class="money-amount">
                    {% if latest_bank_report.ending_balance_display is not None %}
                        $&nbsp;{{ latest_bank_report.ending_balance_display|intcomma }}
                    {% else %}
                        <i>TBD</i>
                    {% endif %}
                </h3>
            </div>
            <div class="panel-body">
                Balance
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="panel panel-money">
            <div class="panel-heading panel-heading-money">
                <h3 class="money-amount">
                    {% if money_2017_raised is not None %}
                        $&nbsp;{{ money_2017_raised|intcomma }}
                    {% else %}
                        <i>TBD</i>
                    {% endif %}
                </h3>
            </div>
            <div class="panel-body">
                Raised in 2017
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="panel panel-money">
            <div class="panel-heading panel-heading-money">
                <h3 class="money-amount">
                    {% if money_2017_spent is not None %}
                        $&nbsp;{{ money_2017_spent|intcomma }}
                    {% else %}
                        <i>TBD</i>
                    {% endif %}
                </h3>
            </div>
            <div class="panel-body">
                Spent in 2017
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="panel panel-money">
            <div class="panel-heading panel-heading-money">
                <h3 class="money-amount">
                    {% if money_2017_start is not None %}
                        $&nbsp;{{ money_2017_start|intcomma }}
                    {% else %}
                        <i>TBD</i>
                    {% endif %}
                </h3>
            </div>
            <div class="panel-body">
                Jan 1, 2017 Balance
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block endscripts %}
    <script>
        $("[data-toggle=tooltip]").tooltip();
    </script>
{% endblock %}
