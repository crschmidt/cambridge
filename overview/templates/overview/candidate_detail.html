{% extends 'base.html' %}
{% load markdown truncate_website from overview %}
{% load static %}
{% load humanize %}

{% block title %}Learn More About {{ candidate.fullname }}{% endblock %}

{% block meta_description %}{{ candidate.blurb|markdown|striptags }}{% endblock %}

{% block head_extra %}
<meta property="og:image" content="{{ candidate.headshot }}">

<script>
    // data for candidate_map.js
    var initialLocations = {{ candidate_locations|safe }};
</script>
<script>{% include "overview/candidate_map.js" %}</script>

<script defer src="//maps.googleapis.com/maps/api/js?&callback=initMap&key=AIzaSyAEvfFrHVngbhqmwUbmZIGrxJpTNReCIeY"></script>

<style>
#map {
    height: 350px;  /* hehehehe */
    width: 100%;
}

.candidate-img img {
    width: 70%; 
    margin-top: 20px;
}

.survey_link {
    display: block;
    margin-top: 0.75em;
}
</style>
{% endblock %}


{% block content %}
<div class="container">
<div class="row">
    <div class="col-md-4 text-center">
        <picture class="candidate-img img-responsive">
            <img
                class="img-circle"
                src="{{ candidate.headshot }}"
                alt="{{ candidate.headshot_description }}">
        </picture>
    </div>

    <div class="col-md-8">
        <h1>{{ candidate.fullname }}</h1>

        {{ candidate.blurb|markdown }}

        <ul class="list-inline">
            {% if candidate.website %}
            <li>
                <a class="candidate_website" target="_blank" href="{{ candidate.website }}">{{ candidate.website|truncate_website }}</a>
            </li>
            {% endif %}

            {% if candidate.email %}
            <li>
                <a class="candidate_website" target="_blank" href="{{ candidate.email}}">{{ candidate.email }}</a>
            </li>
            {% endif %}

            {% if candidate.facebook %}
            <li>
                <a class="btn btn-link" target="_blank" href="{{ candidate.facebook }}"</a>
                    <span class="fa fa-facebook"></span>
                    {{ candidate.facebook }}
                </a>
            </li>
            {% endif %}

            {% if candidate.twitter %}
            <li>
                <a class="btn btn-link" target="_blank" href="#">
                    <span class="fa fa-twitter"></span>
                    {{ candidate.twitter }}
                </a>
                </a>
            </li>
            {% endif %}
        </ul>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <h2 id="demographics">Demographics</h2>

        <table class="table table-condensed">
            <colgroup>
                <col width="20%"></col>
            </colgroup>
            <tbody>
                <tr>
                    <th>Incumbent</th>
                    <td>{{ candidate.is_incumbent|yesno:"Yes,No" }}</td>
                </tr>
                
                {% if candidate.job %}
                <tr>
                    <th>Job</th>
                    <td>{{ candidate.job }}</td>
                </tr>
                {% endif %}
                
                {% if candidate.education %}
                <tr>
                    <th>Education</th>
                    <td>{{ candidate.education }}</td>
                </tr>
                {% endif %}

                <tr>
                    <th>Address</th>
                    <td>
                        {{ candidate.housing_status|title }}s at <strong>{{ candidate.address }}</strong>
                        {% if candidate.housing_sell_value %}
                            <br>
                            <span class="text-muted">Valued at ${{ candidate.housing_sell_value|floatformat:0|intcomma }}</span>
                        {% endif %}
                    </td>
                </tr>

                <tr>
                    <th>Age</th>
                    <td>{{ candidate.date_of_birth|timesince }}
                        {% if candidate.date_of_birth or candidate.place_of_birth %}
                        <br>
                        <span class="text-muted">
                            Born
                            {% if candidate.place_of_birth %}in {{ candidate.place_of_birth }}{% endif %}
                            {% if candidate.date_of_birth %}in {{ candidate.date_of_birth|date:"Y" }}{% endif %}
                        </span>
                        {% endif %}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="col-md-6">
        <div id="map" class="map-container">
            <div class="map-alert">
                <div class="alert alert-warning" data-bind="text:gerror"></div>
            </div>
        </div>
    </div>
</div>

{% comment %}
<div class="row">
    <div class="col-md-12">
        <h2 id="interviews">Interviews</h2>
    </div>

    <!-- ripped from https://codepen.io/mephysto/pen/ZYVKRY -->
    <style>
        .multi-item-carousel .carousel-inner > .item {
          transition: 500ms ease-in-out left;
        }

        .multi-item-carousel .carousel-inner .active.left {
          left: -33%;
        }
        .multi-item-carousel .carousel-inner .active.right {
          left: 33%;
        }
        .multi-item-carousel .carousel-inner .next {
          left: 33%;
        }
        .multi-item-carousel .carousel-inner .prev {
          left: -33%;
        }
        @media all and (transform-3d), (-webkit-transform-3d) {
          .multi-item-carousel .carousel-inner > .item {
            transition: 500ms ease-in-out left;
            transition: 500ms ease-in-out all;
            backface-visibility: visible;
            transform: none !important;
          }
        }
        .multi-item-carousel .carouse-control.left, .multi-item-carousel .carouse-control.right {
          background-image: none;
        }
    </style>

    <script>
        // for every slide in carousel, copy the next slide's item in the slide.
        // Do the same for the next, next item.

        // $(document).ready without jquery yet
        document.addEventListener('DOMContentLoaded', function() {
            $('.multi-item-carousel .item').each(function(){
              var next = $(this).next();
              if (!next.length) {
                next = $(this).siblings(':first');
              }
              next.children(':first-child').clone().appendTo($(this));
              
              if (next.next().length>0) {
                next.next().children(':first-child').clone().appendTo($(this));
              } else {
                $(this).siblings(':first').children(':first-child').clone().appendTo($(this));
              }
            });
        }, false);
    </script>

    <div class="col-md-12">
        <div class="carousel slide multi-item-carousel" id="theCarousel" data-interval="false">
            <div class="carousel-inner">
                <div class="item active">
                    <div class="col-xs-4"><a href="#1"><img src="http://placehold.it/300/f44336/000000" class="img-responsive"></a></div>
                </div>
                <div class="item">
                    <div class="col-xs-4"><a href="#1"><img src="http://placehold.it/300/e91e63/000000" class="img-responsive"></a></div>
                </div>
                <div class="item">
                    <div class="col-xs-4"><a href="#1"><img src="http://placehold.it/300/9c27b0/000000" class="img-responsive"></a></div>
                </div>
                <div class="item">
                    <div class="col-xs-4"><a href="#1"><img src="http://placehold.it/300/673ab7/000000" class="img-responsive"></a></div>
                </div>
                <div class="item">
                    <div class="col-xs-4"><a href="#1"><img src="http://placehold.it/300/4caf50/000000" class="img-responsive"></a></div>
                </div>
                <div class="item">
                    <div class="col-xs-4"><a href="#1"><img src="http://placehold.it/300/8bc34a/000000" class="img-responsive"></a></div>
                </div>
                <!-- add  more items here -->
                <!-- Example item start:  -->

                <div class="item">
                    <div class="col-xs-4"><a href="#1"><img src="http://placehold.it/300/8bc34a/000000" class="img-responsive"></a></div>
                </div>

                <!--  Example item end -->
            </div>
            <a class="left carousel-control" href="#theCarousel" data-slide="prev"><i class="glyphicon glyphicon-chevron-left"></i></a>
            <a class="right carousel-control" href="#theCarousel" data-slide="next"><i class="glyphicon glyphicon-chevron-right"></i></a>
        </div>
    </div>
</div>
{% endcomment %}


{% comment %}
<div class="row">
    <div class="col-md-12">
        <h2 id="press">Press</h2>
    </div>

    <div class="col-md-6">
        <h3>Authored</h3>
        <ul>
            <li>{% lorem 7 w random %}</li>
        </ul>
    </div>

    <div class="col-md-6">
        <h3>About</h3>
        <ul>
            <li>{% lorem 7 w random %}</li>
            <li>{% lorem 7 w random %}</li>
            <li>{% lorem 7 w random %}</li>
            <li>{% lorem 7 w random %}</li>
        </ul>
    </div>
</div>
{% endcomment %}

<div class="row">
    <div class="col-md-12">
        <h2 id="questionnaires">Questionnaire</h2>
    </div>

    <div class="col-md-12 table-responsive">
        <table class="table">
            <colgroup>
                <col style="width: 2em"></col>
            </colgroup>
            <tbody>
                {% for questionnaire in candidate.questionnaire_set.all %}
                <tr>
                    <td>
                        <i class="hidden-xs fa fa-2x fa-fw {{ questionnaire.survey.icon_class }}" aria-hidden="true"></i>
                        <i class="visible-xs fa fa-fw {{ questionnaire.survey.icon_class }}" aria-hidden="true"></i>
                    </td>
                    <td>{{ questionnaire.survey.topic }}</td>
                    <td>
                        {{ questionnaire.survey.name }}
                        <a class="fa fa-info-circle" 
                           href="#!" 
                           data-toggle="popover" 
                           data-html="true" 
                           data-container="body" 
                           data-title="{{ questionnaire.survey.name }}" 
                           data-content='{{ questionnaire.survey.description }}<a class="survey_link" target="_blank" href="{{questionnaire.survey_link }}">Read the Survey</a>'></a>
                    </td>
                    <td>{% if questionnaire.date %}
                            {{ questionnaire.date|date:"c" }}
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<div class="row">
    <div class="col-md-12">
        <h2 id="finance">Campaign Finance</h2>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="panel panel-money">
            <div class="panel-heading panel-heading-money">
                <h3 class="money-amount">
                    {% if latest_bank_report.ending_balance_display is not None %}
                        $&nbsp;{{ latest_bank_report.ending_balance_display|intcomma }}
                    {% else %}
                        <i>TBD</i>
                    {% endif %}
                </h3>
            </div>
            <div class="panel-body">
                Balance
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="panel panel-money">
            <div class="panel-heading panel-heading-money">
                <h3 class="money-amount">
                    {% if money_2017_raised is not None %}
                        $&nbsp;{{ money_2017_raised|intcomma }}
                    {% else %}
                        <i>TBD</i>
                    {% endif %}
                </h3>
            </div>
            <div class="panel-body">
                Raised in 2017
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="panel panel-money">
            <div class="panel-heading panel-heading-money">
                <h3 class="money-amount">
                    {% if money_2017_spent is not None %}
                        $&nbsp;{{ money_2017_spent|intcomma }}
                    {% else %}
                        <i>TBD</i>
                    {% endif %}
                </h3>
            </div>
            <div class="panel-body">
                Spent in 2017
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="panel panel-money">
            <div class="panel-heading panel-heading-money">
                <h3 class="money-amount">
                    {% if money_2017_start is not None %}
                        $&nbsp;{{ money_2017_start|intcomma }}
                    {% else %}
                        <i>TBD</i>
                    {% endif %}
                </h3>
            </div>
            <div class="panel-body">
                Jan 1, 2017 Balance
            </div>
        </div>
    </div>
    <div class="col-md-12">
        To see how this candidate compares, check out <a href="{% url 'finance_comparison' %}">finance comparison</a>.
    </div>
</div>
</div>
{% endblock %}


{% block endscripts %}
    <script>
        $("[data-toggle=tooltip]").tooltip();
        $("[data-toggle=popover]").popover();
    </script>
{% endblock %}
